<?php
    require_once __DIR__ . '/../core/Controller.php';
    require_once __DIR__ . '/../core/Session.php';
    require_once __DIR__ . '/../modal/OrderItem.php';

    class Index extends Controller
    {
        public $template = 'user_detail.twig';

        function get()
        {

            $all_order_item = OrderItem::get_all();
            $cahr_string = '0123456789abcdefghijklmnopqrstuvwxyz';
            $map = [];

            foreach (str_split($cahr_string) as $char_x) {
                $map[$char_x] = [];
                foreach (str_split($cahr_string) as $char_y) {
                    $map[$char_x][$char_y] = 0;
                }
            }
            $max_energy = 0;
            foreach ($all_order_item as $order_item) {
                if (!isset($map[$order_item->position_x][$order_item->position_y])) {
                    $map[$order_item->position_x][$order_item->position_y] = 0;
                    $map[$order_item->position_x][$order_item->position_y] += $order_item->quantity_energy;
                } else {
                    $map[$order_item->position_x][$order_item->position_y] += $order_item->quantity_energy;

                }
                if ($map[$order_item->position_x][$order_item->position_y] > $max_energy) {
                    $max_energy = $map[$order_item->position_x][$order_item->position_y];
                }
            }
            echo parent::render(
                [
                    'is_auth' => Session::is_authenticated(),
                    'map' => $map,
                    'max_energy' => $max_energy,
                    'min_energy' => 0
                ]
            ); // TODO: Change the autogenerated stub
        }
    }